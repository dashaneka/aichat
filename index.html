<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat Assistant</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Puter.js for AI functionality -->
    <script src="https://js.puter.com/v2/"></script>

    <!-- Marked.js for rendering Markdown in AI responses -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Custom styles to complement Tailwind */
        body {
            font-family: 'Poppins', sans-serif;
        }
        /* Custom scrollbar for a cleaner look */
        #messages-container::-webkit-scrollbar {
            width: 8px;
        }
        #messages-container::-webkit-scrollbar-track {
            background: #1e293b;
        }
        #messages-container::-webkit-scrollbar-thumb {
            background: #4f46e5;
            border-radius: 4px;
        }
        #messages-container::-webkit-scrollbar-thumb:hover {
            background: #6366f1;
        }
        
        /* Styles for Markdown-rendered content in AI responses */
        .prose {
            line-height: 1.7; /* Improved line spacing */
        }
        .prose p, .prose ul, .prose ol {
            margin-bottom: 1.25rem;
            letter-spacing: 0.025em; /* Improved letter spacing */
        }
        .prose pre {
            background-color: #0f172a;
            color: #e2e8f0;
            padding: 1.25rem;
            border-radius: 0.75rem;
            overflow-x: auto;
            border: 1px solid #334155;
        }
        .prose code {
            background-color: #334155;
            color: #f1f5f9;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.9em;
        }
        .prose pre code {
             background-color: transparent;
             padding: 0;
             border: none;
        }
        .prose blockquote {
            border-left-color: #f97316;
            padding-left: 1rem;
            font-style: italic;
            color: #d1d5db;
        }
        .message-bubble:hover .copy-btn {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-200">

    <div id="chat-container" class="flex flex-col h-screen w-full max-w-4xl mx-auto bg-gradient-to-br from-slate-900 to-black shadow-2xl border border-slate-700 rounded-lg overflow-hidden">
        
        <!-- Header -->
        <header class="p-4 border-b border-slate-700/50 flex justify-between items-center">
            <h1 class="text-xl font-bold text-white">AI Chat Assistant</h1>
            <div class="flex items-center gap-2">
                <label for="model-selector" class="text-sm font-medium text-slate-400">Model:</label>
                <select id="model-selector" class="bg-slate-800 border border-slate-600 text-white text-sm rounded-lg focus:ring-orange-500 focus:border-orange-500 block w-full p-2">
                    <option selected>gpt-4o</option>
                    <option>gpt-5</option>
                    <option>gpt-4.1</option>
                    <option>o1-pro</option>
                    <option>o3</option>
                    <option>o3-mini</option>
                    <option>o4-mini</option>
                    <option>gpt-4.5-preview</option>
                </select>
            </div>
        </header>

        <!-- Messages Area -->
        <main id="messages-container" class="flex-1 p-6 overflow-y-auto space-y-8">
            <!-- Initial AI Message -->
             <div class="flex items-start gap-4 message-bubble">
                <div class="flex-shrink-0 h-10 w-10 rounded-full bg-gradient-to-br from-orange-500 to-yellow-500 flex items-center justify-center text-white font-bold">AI</div>
                <div class="relative group bg-slate-800 rounded-lg p-4 max-w-2xl">
                    <p>Hello! Select a model and ask me anything.</p>
                    <button onclick="copyToClipboard(this)" class="copy-btn absolute top-2 right-2 p-1.5 bg-slate-700 rounded-md text-slate-400 hover:text-white opacity-0 transition-opacity">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                    </button>
                </div>
            </div>
        </main>

        <!-- Typing Indicator -->
        <div id="typing-indicator" class="hidden p-6 pt-0">
             <div class="flex items-center gap-4">
                <div class="flex-shrink-0 h-10 w-10 rounded-full bg-gradient-to-br from-orange-500 to-yellow-500 flex items-center justify-center text-white font-bold">AI</div>
                <div class="bg-slate-800 rounded-lg p-4 flex items-center">
                    <div class="flex items-center justify-center gap-1.5">
                        <span class="h-2 w-2 bg-orange-400 rounded-full animate-bounce [animation-delay:-0.3s]"></span>
                        <span class="h-2 w-2 bg-orange-400 rounded-full animate-bounce [animation-delay:-0.15s]"></span>
                        <span class="h-2 w-2 bg-orange-400 rounded-full animate-bounce"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Form -->
        <footer class="p-4 border-t border-slate-700/50">
            <form id="chat-form" class="flex items-center gap-4">
                <input type="text" id="input-message" placeholder="Ask me anything..." class="flex-1 p-3 rounded-lg bg-slate-800 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-orange-500 transition" autocomplete="off">
                <button type="submit" class="bg-gradient-to-r from-orange-500 to-yellow-500 hover:from-orange-600 hover:to-yellow-600 text-white font-semibold p-3 rounded-lg transition shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 focus:ring-offset-slate-900">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                </button>
            </form>
        </footer>
    </div>

    <script>
        // DOM Elements
        const chatForm = document.getElementById('chat-form');
        const inputMessage = document.getElementById('input-message');
        const messagesContainer = document.getElementById('messages-container');
        const typingIndicator = document.getElementById('typing-indicator');
        const modelSelector = document.getElementById('model-selector');

        // Conversation history
        const messages = [{
            role: 'assistant',
            content: 'Hello! Select a model and ask me anything.'
        }];

        // --- Event Listeners ---
        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            sendMessage();
        });

        // --- Functions ---

        /**
         * Handles sending a message from the user input.
         */
        function sendMessage() {
            const messageText = inputMessage.value.trim();
            if (!messageText) return;

            addMessageToUI(messageText, 'user');
            messages.push({ content: messageText, role: 'user' });

            inputMessage.value = '';
            inputMessage.focus();
            
            showTypingIndicator(true);
            getAIResponse();
        }

        /**
         * Fetches a response from the Puter.js AI using the selected model.
         */
        async function getAIResponse() {
            const selectedModel = modelSelector.value;
            try {
                const response = await puter.ai.chat(messages, { model: selectedModel });
                showTypingIndicator(false);

                if (response && response.message) {
                    messages.push(response.message);
                    addMessageToUI(response.message.content, 'assistant');
                } else {
                    throw new Error("Invalid response from AI.");
                }
            } catch (error) {
                console.error("AI response error:", error);
                showTypingIndicator(false);
                addMessageToUI(`Sorry, I encountered an error with the ${selectedModel} model. Please try another model or try again.`, 'error');
            }
        }
        
        /**
         * Adds a message bubble to the chat UI.
         * @param {string} text - The message content.
         * @param {'user' | 'assistant' | 'error'} sender - Who sent the message.
         */
        function addMessageToUI(text, sender) {
            const messageWrapper = document.createElement('div');
            messageWrapper.className = 'message-bubble';
            
            if (sender === 'user') {
                messageWrapper.classList.add('flex', 'items-start', 'gap-4', 'justify-end');
                messageWrapper.innerHTML = `
                    <div class="relative group bg-indigo-600 text-white rounded-lg p-4 max-w-2xl">
                        <p>${text}</p>
                        <button onclick="copyToClipboard(this)" class="copy-btn absolute top-2 right-2 p-1.5 bg-indigo-500 rounded-md text-indigo-200 hover:text-white opacity-0 transition-opacity">
                           <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        </button>
                    </div>
                    <div class="flex-shrink-0 h-10 w-10 rounded-full bg-slate-700 flex items-center justify-center text-orange-400 font-bold">RJ</div>
                `;
            } else if (sender === 'assistant') {
                messageWrapper.classList.add('flex', 'items-start', 'gap-4');
                messageWrapper.innerHTML = `
                    <div class="flex-shrink-0 h-10 w-10 rounded-full bg-gradient-to-br from-orange-500 to-yellow-500 flex items-center justify-center text-white font-bold">AI</div>
                    <div class="relative group bg-slate-800 rounded-lg p-4 max-w-2xl">
                        <div class="prose prose-slate dark:prose-invert"></div>
                        <button onclick="copyToClipboard(this)" class="copy-btn absolute top-2 right-2 p-1.5 bg-slate-700 rounded-md text-slate-400 hover:text-white opacity-0 transition-opacity">
                           <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                        </button>
                    </div>
                `;
                messagesContainer.appendChild(messageWrapper);
                const contentDiv = messageWrapper.querySelector('.prose');
                typeWriter(contentDiv, text);
            } else if (sender === 'error') {
                 messageWrapper.classList.add('flex', 'items-start', 'gap-4');
                 messageWrapper.innerHTML = `
                    <div class="flex-shrink-0 h-10 w-10 rounded-full bg-red-500 flex items-center justify-center text-white font-bold">!</div>
                    <div class="bg-red-900/50 border border-red-700 text-red-300 rounded-lg p-4 max-w-2xl">
                        <p>${text}</p>
                    </div>
                `;
            }

            if (sender !== 'assistant') {
                messagesContainer.appendChild(messageWrapper);
            }
            
            scrollToBottom();
        }

        /**
         * Simulates a typewriter effect for the AI's response.
         * @param {HTMLElement} element - The element to type into.
         * @param {string} text - The text to type.
         */
        function typeWriter(element, text) {
            const finalHtml = marked.parse(text);
            element.innerHTML = finalHtml;
            
            // A simple fade-in effect for the new message
            element.style.opacity = '0';
            let opacity = 0;
            const interval = setInterval(() => {
                opacity += 0.1;
                element.style.opacity = opacity;
                if (opacity >= 1) clearInterval(interval);
            }, 20);

            scrollToBottom();
        }

        /**
         * Shows or hides the typing indicator.
         * @param {boolean} show - Whether to show or hide the indicator.
         */
        function showTypingIndicator(show) {
            typingIndicator.classList.toggle('hidden', !show);
            if(show) scrollToBottom();
        }

        /**
         * Scrolls the message container to the very bottom.
         */
        function scrollToBottom() {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        /**
         * Copies the text content of a message to the clipboard.
         * @param {HTMLElement} buttonElement - The copy button that was clicked.
         */
        function copyToClipboard(buttonElement) {
            // Find the content container (p or .prose) which is a sibling of the button.
            const messageContentElement = buttonElement.parentElement.querySelector('p, .prose');
            if (!messageContentElement) return;

            const textToCopy = messageContentElement.innerText;
            
            const textarea = document.createElement('textarea');
            textarea.value = textToCopy;
            textarea.style.position = 'absolute';
            textarea.style.left = '-9999px';
            textarea.setAttribute('readonly', '');

            document.body.appendChild(textarea);
            textarea.select();

            try {
                document.execCommand('copy');
                // Provide visual feedback
                const originalIcon = buttonElement.innerHTML;
                buttonElement.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="text-green-400"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
                setTimeout(() => {
                    buttonElement.innerHTML = originalIcon;
                }, 1500);
            } catch (err) {
                console.error('Failed to copy text: ', err);
            } finally {
                document.body.removeChild(textarea);
            }
        }

    </script>
</body>
</html>
